{
  "stages": [
    {
      "id": 1,
      "name": "Initial_Cleanup",
      "scripts": [
        {
          "name": "old_results_wipe.py",
          "flags": []
        },
        {
          "name": "cleanup.py",
          "flags": []
        }
      ]
    },
    {
      "id": 2,
      "name": "Phase1_Target_Normalization",
      "scripts": [
        {
          "name": "TargetNormalizer.py",
          "flags": [
            "--input",
            "targets.txt",
            "--output",
            "{output_dir}/raw_outputs/phase1/targets.json",
            "--env-config",
            "config/environment.yml"
          ]
        }
      ]
    },
    {
      "id": 3,
      "name": "Phase1_Modular_Recon",
      "scripts": [
        {
          "name": "ReconOrchestrator.py",
          "flags": [
            "--targets",
            "{output_dir}/raw_outputs/phase1/targets.json",
            "--output-dir",
            "{output_dir}/raw_outputs",
            "--config",
            "config/recon.yml",
            "--env-config",
            "config/environment.yml"
          ]
        }
      ]
    },
    {
      "id": 4,
      "name": "Phase1_DNS_Resolution",
      "scripts": [
        {
          "name": "resolver.py",
          "flags": [
            "--input-dir",
            "{output_dir}/raw_outputs/recon_outputs",
            "--output",
            "{output_dir}/raw_outputs/phase1/resolved.json",
            "--env-config",
            "config/environment.yml"
          ]
        }
      ]
    },
    {
      "id": 5,
      "name": "Phase1_HTTP_Probe",
      "scripts": [
        {
          "name": "http_probe.py",
          "flags": [
            "--resolved-json",
            "{output_dir}/raw_outputs/phase1/resolved.json",
            "--output",
            "{output_dir}/raw_outputs/phase1/http_probe.csv",
            "--env-config",
            "config/environment.yml"
          ]
        }
      ]
    },
    {
      "id": 6,
      "name": "Phase1_IP_Harvest",
      "scripts": [
        {
          "name": "ip_harvester.py",
          "flags": [
            "--resolved-json",
            "{output_dir}/raw_outputs/phase1/resolved.json",
            "--http-probe",
            "{output_dir}/raw_outputs/phase1/http_probe.csv",
            "--pairs-output",
            "{output_dir}/raw_outputs/domain_ip_pairs.txt",
            "--ips-output",
            "{output_dir}/raw_outputs/all_resolved_ips.txt",
            "--summary-output",
            "{output_dir}/raw_outputs/resolution_summary.csv",
            "--env-config",
            "config/environment.yml"
          ]
        }
      ]
    },
    {
      "id": 7,
      "name": "Phase1_Dev_Cap_IP_Files",
      "scripts": [
        {
          "name": "dev_cap_file.py",
          "flags": [
            "--env-config",
            "config/environment.yml",
            "--file",
            "{output_dir}/raw_outputs/domain_ip_pairs.txt",
            "--file",
            "{output_dir}/raw_outputs/all_resolved_ips.txt"
          ]
        }
      ]
    },
    {
      "id": 8,
      "name": "Phase1_Collect_And_Clean_Recon",
      "scripts": [
        {
          "name": "collect_recon.py",
          "flags": [
            "--recon-dir",
            "{output_dir}/raw_outputs/recon_outputs",
            "--resolved-json",
            "{output_dir}/raw_outputs/phase1/resolved.json",
            "--http-probe",
            "{output_dir}/raw_outputs/phase1/http_probe.csv",
            "--output-csv",
            "{output_dir}/raw_outputs/Recon_out.csv",
            "--domains-output",
            "{output_dir}/raw_outputs/domains_only.txt"
          ]
        }
      ]
    },
    {
      "id": 9,
      "name": "Dev_Cap_Domains_Only",
      "scripts": [
        {
          "name": "dev_cap_file.py",
          "flags": [
            "--env-config",
            "config/environment.yml",
            "--file",
            "{output_dir}/raw_outputs/domains_only.txt"
          ]
        }
      ]
    },
    {
      "id": 10,
      "name": "Distributed_WHOIS_Batch_1",
      "scripts": [
        {
          "name": "distributed_whois.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/all_resolved_ips.txt",
            "-o",
            "{output_dir}/raw_outputs/whois_results.csv",
            "--state-file",
            "{output_dir}/raw_outputs/whois_scan_state.json",
            "--config",
            "config/whois.yml"
          ]
        }
      ]
    },
    {
      "id": 11,
      "name": "Phase2_DNS_And_Filtering",
      "scripts": [
        {
          "name": "domain_filter.py",
          "flags": [
            "--recon-dir",
            "{output_dir}/raw_outputs/recon_outputs",
            "--config",
            "config/domain_filters.yml",
            "--output-csv",
            "{output_dir}/raw_outputs/filtered_domains.csv",
            "--output-txt",
            "{output_dir}/raw_outputs/filtered_domains.txt",
            "--env-config",
            "config/environment.yml"
          ]
        },
        {
          "name": "dns_suite.py",
          "flags": [
            "--domains",
            "{output_dir}/raw_outputs/filtered_domains.txt",
            "--records-csv",
            "{output_dir}/raw_outputs/dns_records.csv",
            "--health-json",
            "{output_dir}/raw_outputs/dns_health.json",
            "--internal-output",
            "{output_dir}/raw_outputs/internal_dns_findings.txt",
            "--env-config",
            "config/environment.yml"
          ]
        }
      ]
    },
    {
      "id": 12,
      "name": "Phase2_Typosquat",
      "scripts": [
        {
          "name": "typosquat_monitor.py",
          "flags": [
            "--input",
            "{output_dir}/raw_outputs/filtered_domains.txt",
            "--config",
            "config/typosquat.yml",
            "--env-config",
            "config/environment.yml",
            "--output",
            "{output_dir}/raw_outputs/typo_candidates.csv"
          ]
        }
      ]
    },
    {
      "id": 13,
      "name": "Phase2_Domain_List_Preparation",
      "scripts": [
        {
          "name": "extract_column.py",
          "flags": [
            "--input",
            "{output_dir}/raw_outputs/filtered_domains.csv",
            "--column",
            "Domain",
            "--output",
            "{output_dir}/raw_outputs/filtered_domains.txt"
          ]
        }
      ]
    },
    {
      "id": 14,
      "name": "Phase2_Certificate_Intelligence",
      "scripts": [
        {
          "name": "CRT_transparency.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/filtered_domains.txt",
            "-o",
            "{output_dir}/raw_outputs/crt_transparency.csv"
          ]
        }
      ]
    },
    {
      "id": 15,
      "name": "Dev_Cap_Filtered_Domains",
      "scripts": [
        {
          "name": "dev_cap_file.py",
          "flags": [
            "--env-config",
            "config/environment.yml",
            "--file",
            "{output_dir}/raw_outputs/filtered_domains.txt"
          ]
        }
      ]
    },
    {
      "id": 16,
      "name": "Phase2_Email_And_Internal_DNS",
      "scripts": [
        {
          "name": "Email_Security_Audit.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/filtered_domains.txt",
            "-o",
            "{output_dir}/raw_outputs/Email_Security_Audit_out.csv"
          ]
        },
        {
          "name": "Detect_Internal_DNS.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/filtered_domains.txt",
            "-o",
            "{output_dir}/raw_outputs/Detect_Internal_DNS_out.txt"
          ]
        }
      ]
    },
    {
      "id": 17,
      "name": "Phase2_DNS_Format_Adapter",
      "scripts": [
        {
          "name": "dns_format_adapter.py",
          "flags": [
            "--resolved-json",
            "{output_dir}/raw_outputs/phase1/resolved.json",
            "--output",
            "{output_dir}/raw_outputs/DnsResolver_out.csv"
          ]
        }
      ]
    },
    {
      "id": 18,
      "name": "Legacy_Dead_DNS_Checker",
      "scripts": [
        {
          "name": "Dead_DNS_Checker.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/DnsResolver_out.csv",
            "-o",
            "{output_dir}/raw_outputs/Dead_DNS_Checker_out.csv"
          ]
        }
      ]
    },
    {
      "id": 19,
      "name": "Legacy_Dead_DNS_Resolver",
      "scripts": [
        {
          "name": "Dead_DNS_Resolver.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/DnsResolver_out.csv",
            "-o",
            "{output_dir}/raw_outputs/Dead_DNS_Resolver_out.csv"
          ]
        }
      ]
    },
    {
      "id": 20,
      "name": "Clean_DNS_Checks_Output",
      "scripts": [
        {
          "name": "clean_output.py",
          "flags": [
            "{output_dir}/raw_outputs/dns_records.csv",
            "{output_dir}/raw_outputs/clean_dnschecks.txt"
          ]
        }
      ]
    },
    {
      "id": 21,
      "name": "Dev_Cap_Clean_DNSChecks",
      "scripts": [
        {
          "name": "dev_cap_file.py",
          "flags": [
            "--env-config",
            "config/environment.yml",
            "--file",
            "{output_dir}/raw_outputs/clean_dnschecks.txt"
          ]
        }
      ]
    },
    {
      "id": 22,
      "name": "Distributed_WHOIS_Batch_2",
      "scripts": [
        {
          "name": "distributed_whois.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/all_resolved_ips.txt",
            "-o",
            "{output_dir}/raw_outputs/whois_results.csv",
            "--state-file",
            "{output_dir}/raw_outputs/whois_scan_state.json",
            "--config",
            "config/whois.yml"
          ]
        }
      ]
    },
    {
      "id": 23,
      "name": "Phase2_S3_Bucket_Checks",
      "scripts": [
        {
          "name": "S3_Bucket_Check.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/filtered_domains.txt",
            "-o",
            "{output_dir}/raw_outputs/S3_Bucket_Check_out.csv",
            "--config",
            "config/s3.yml",
            "--env-config",
            "config/environment.yml"
          ]
        },
        {
          "name": "Bucket_To_URL.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/S3_Bucket_Check_out.csv",
            "-o",
            "{output_dir}/raw_outputs/Bucket_To_URL_out.csv"
          ]
        }
      ]
    },
    {
      "id": 24,
      "name": "Phase2_Multi_Cloud_Storage_Scan",
      "scripts": [
        {
          "name": "Other_Buckets.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/filtered_domains.txt",
            "-o",
            "{output_dir}/raw_outputs/Other_Buckets_out.csv",
            "--config",
            "config/cloud_storage.yml",
            "--env-config",
            "config/environment.yml"
          ]
        }
      ]
    },
    {
      "id": 25,
      "name": "Distributed_WHOIS_Batch_3",
      "scripts": [
        {
          "name": "distributed_whois.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/all_resolved_ips.txt",
            "-o",
            "{output_dir}/raw_outputs/whois_results.csv",
            "--state-file",
            "{output_dir}/raw_outputs/whois_scan_state.json",
            "--config",
            "config/whois.yml"
          ]
        }
      ]
    },
    {
      "id": 26,
      "name": "Phase3_Web_Host_Discovery",
      "scripts": [
        {
          "name": "web_host_discovery.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/Recon_out.csv",
            "-o",
            "{output_dir}/raw_outputs/live_web_hosts.txt"
          ]
        }
      ]
    },
    {
      "id": 27,
      "name": "Dev_Cap_Live_Web_Hosts",
      "scripts": [
        {
          "name": "dev_cap_file.py",
          "flags": [
            "--env-config",
            "config/environment.yml",
            "--file",
            "{output_dir}/raw_outputs/live_web_hosts.txt"
          ]
        }
      ]
    },
    {
      "id": 28,
      "name": "Prepare_Web_Asset_Lists",
      "scripts": [
        {
          "name": "prepare_web_asset_lists.py",
          "flags": [
            "--recon-csv",
            "{output_dir}/raw_outputs/Recon_out.csv",
            "--live-hosts",
            "{output_dir}/raw_outputs/live_web_hosts.txt",
            "--output-dir",
            "{output_dir}/raw_outputs"
          ]
        }
      ]
    },
    {
      "id": 29,
      "name": "Dev_Cap_Live_Web_Host_Domains",
      "scripts": [
        {
          "name": "dev_cap_file.py",
          "flags": [
            "--env-config",
            "config/environment.yml",
            "--file",
            "{output_dir}/raw_outputs/live_web_hosts_domains.txt"
          ]
        }
      ]
    },
    {
      "id": 30,
      "name": "Phase3_Unified_Tech_Detection",
      "scripts": [
        {
          "name": "tech_detection_service.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/live_web_hosts.txt",
            "-o",
            "{output_dir}/raw_outputs/tech_detection_unified.csv",
            "-j",
            "{output_dir}/raw_outputs/tech_detection_unified.json",
            "-c",
            "config/tech_detection.yml",
            "--env-config",
            "config/environment.yml"
          ]
        },
        {
          "name": "Dir_Listing_Checker.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/live_web_hosts.txt",
            "-o",
            "{output_dir}/raw_outputs/Dir_Listing_Checker_out.csv"
          ]
        },
        {
          "name": "Non_Production_domains.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/live_web_hosts_domains.txt",
            "-o",
            "{output_dir}/raw_outputs/Non_Production_domains_out.txt"
          ]
        }
      ]
    },
    {
      "id": 31,
      "name": "Distributed_WHOIS_Batch_4",
      "scripts": [
        {
          "name": "distributed_whois.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/all_resolved_ips.txt",
            "-o",
            "{output_dir}/raw_outputs/whois_results.csv",
            "--state-file",
            "{output_dir}/raw_outputs/whois_scan_state.json",
            "--config",
            "config/whois.yml"
          ]
        }
      ]
    },
    {
      "id": 32,
      "name": "Phase3_Web_Scanning",
      "scripts": [
        {
          "name": "redirectissuefinder.py",
          "flags": [
            "-df",
            "{output_dir}/raw_outputs/live_web_hosts.txt",
            "-o",
            "{output_dir}/raw_outputs/redirectissuefinder_out.csv"
          ]
        }
      ]
    },
    {
      "id": 33,
      "name": "Phase3_Web_Exposure",
      "scripts": [
        {
          "name": "Admin_Login_Enumerator.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/live_web_hosts_domains.txt",
            "-o",
            "{output_dir}/raw_outputs/Admin_Login_Enumerator_out.csv"
          ]
        },
        {
          "name": "Git_Leak.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/live_web_hosts_domains.txt",
            "-o",
            "{output_dir}/raw_outputs/Git_Leak_out.csv"
          ]
        },
        {
          "name": "SSL_TLS_Cert_Check.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/live_web_hosts_domains.txt",
            "-o",
            "{output_dir}/raw_outputs/SSL_TLS_Cert_Check_out.csv"
          ]
        },
        {
          "name": "WAF_Checker.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/live_web_hosts_domains.txt",
            "-o",
            "{output_dir}/raw_outputs/WAF_Checker_out.csv"
          ]
        },
        {
          "name": "Cloud_Misconfig.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/domain_ip_pairs.txt",
            "-o",
            "{output_dir}/raw_outputs/Cloud_Misconfig_out.csv"
          ]
        }
      ]
    },
    {
      "id": 34,
      "name": "Phase3_VNC_Scan",
      "scripts": [
        {
          "name": "vnc_scan.py",
          "flags": [
            "--hosts-file",
            "{output_dir}/raw_outputs/domain_ip_pairs.txt",
            "--output",
            "{output_dir}/raw_outputs/VNC_Checker_out.csv",
            "--state-file",
            "{output_dir}/raw_outputs/vnc_scan_state.json",
            "--config",
            "config/vnc.yml",
            "--env-config",
            "config/environment.yml"
          ]
        }
      ]
    },
    {
      "id": 35,
      "name": "Phase3_VNC_Scan_Batch_2",
      "scripts": [
        {
          "name": "vnc_scan.py",
          "flags": [
            "--hosts-file",
            "{output_dir}/raw_outputs/domain_ip_pairs.txt",
            "--output",
            "{output_dir}/raw_outputs/VNC_Checker_out.csv",
            "--state-file",
            "{output_dir}/raw_outputs/vnc_scan_state.json",
            "--config",
            "config/vnc.yml",
            "--env-config",
            "config/environment.yml"
          ]
        }
      ]
    },
    {
      "id": 36,
      "name": "Phase3_VNC_Scan_Batch_3",
      "scripts": [
        {
          "name": "vnc_scan.py",
          "flags": [
            "--hosts-file",
            "{output_dir}/raw_outputs/domain_ip_pairs.txt",
            "--output",
            "{output_dir}/raw_outputs/VNC_Checker_out.csv",
            "--state-file",
            "{output_dir}/raw_outputs/vnc_scan_state.json",
            "--config",
            "config/vnc.yml",
            "--env-config",
            "config/environment.yml"
          ]
        }
      ]
    },
    {
      "id": 37,
      "name": "Phase3_Port_Discovery",
      "scripts": [
        {
          "name": "Open_Ports_1.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/domain_ip_pairs.txt",
            "-o",
            "{output_dir}/raw_outputs/Open_Ports_1_out.csv"
          ]
        }
      ]
    },
    {
      "id": 38,
      "name": "Phase3_Debug_Paths_Check",
      "scripts": [
        {
          "name": "Debug_paths.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/Dir_Listing_Checker_out.csv",
            "-o",
            "{output_dir}/raw_outputs/Debug_paths_out.csv"
          ]
        }
      ]
    },
    {
      "id": 39,
      "name": "Phase3_Default_Page_Check",
      "scripts": [
        {
          "name": "Default_Page_Checker.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/live_web_hosts.txt",
            "-o",
            "{output_dir}/raw_outputs/Default_Page_Checker_out.csv",
            "-t",
            "10"
          ]
        }
      ]
    },
    {
      "id": 40,
      "name": "Distributed_WHOIS_Batch_5",
      "scripts": [
        {
          "name": "distributed_whois.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/all_resolved_ips.txt",
            "-o",
            "{output_dir}/raw_outputs/whois_results.csv",
            "--state-file",
            "{output_dir}/raw_outputs/whois_scan_state.json",
            "--config",
            "config/whois.yml"
          ]
        }
      ]
    },
    {
      "id": 41,
      "name": "Prepare_Priority_Screenshot_Targets",
      "scripts": [
        {
          "name": "prepare_priority_screenshots.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs",
            "-o",
            "{output_dir}/raw_outputs/priority_screenshot_targets.txt"
          ]
        }
      ]
    },
    {
      "id": 42,
      "name": "Phase3_Screenshot_Priority_Targets",
      "scripts": [
        {
          "name": "screenshot_service.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/priority_screenshot_targets.txt",
            "-o",
            "{output_dir}/screenshots/priority_targets",
            "-c",
            "config/screenshots.yml"
          ]
        }
      ]
    },
    {
      "id": 43,
      "name": "Distributed_WHOIS_Batch_6",
      "scripts": [
        {
          "name": "distributed_whois.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/all_resolved_ips.txt",
            "-o",
            "{output_dir}/raw_outputs/whois_results.csv",
            "--state-file",
            "{output_dir}/raw_outputs/whois_scan_state.json",
            "--config",
            "config/whois.yml"
          ]
        }
      ]
    },
    {
      "id": 44,
      "name": "Phase3_Subdomain_Takeover_Detection",
      "scripts": [
        {
          "name": "Subdomain_Takeover_Checker.py",
          "flags": [
            "-i",
            "{output_dir}/raw_outputs/filtered_domains.txt",
            "-o",
            "{output_dir}/raw_outputs/Subdomain_Takeover_out.csv"
          ]
        }
      ]
    },
    {
      "id": 45,
      "name": "Phase4_Threat_Context_Enrichment",
      "scripts": [
        {
          "name": "threat_context_enricher.py",
          "flags": [
            "--input-dir",
            "{output_dir}/raw_outputs",
            "--output-dir",
            "{output_dir}/threat_context",
            "--config",
            "config/threat_intel.yml",
            "--env-config",
            "config/environment.yml"
          ]
        }
      ]
    },
    {
      "id": 46,
      "name": "Phase4_Normalize_And_Deduplicate",
      "scripts": [
        {
          "name": "merge_outputs.py",
          "flags": [
            "--indir",
            "{output_dir}/raw_outputs",
            "--outdir",
            "{output_dir}/processed/merged"
          ]
        }
      ]
    },
    {
      "id": 47,
      "name": "Final_Enrichment_And_Reporting",
      "scripts": [
        {
          "name": "merge_whois.py",
          "flags": [
            "--recon-file",
            "{output_dir}/raw_outputs/Recon_out.csv",
            "--whois-file",
            "{output_dir}/raw_outputs/whois_results.csv",
            "--output-file",
            "{output_dir}/raw_outputs/Recon_out_enriched.csv"
          ]
        },
        {
          "name": "bash",
          "flags": [
            "-c",
            "cd Reporting_Toolkit && python3 generate_report.py --input-file \"../{output_dir}/raw_outputs/Recon_out_enriched.csv\" --output-dir \"../{output_dir}/FINAL_REPORT\""
          ]
        }
      ]
    },
    {
      "id": 48,
      "name": "Phase4_Change_Detection",
      "scripts": [
        {
          "name": "change_detector.py",
          "flags": [
            "--current-dir",
            "{output_dir}/raw_outputs",
            "--baseline-dir",
            "baselines/{organization}",
            "--org-name",
            "{organization}",
            "--output-dir",
            "{output_dir}/changes",
            "--config",
            "config/change_detection.yml",
            "--update-baseline"
          ]
        }
      ]
    }
  ]
}